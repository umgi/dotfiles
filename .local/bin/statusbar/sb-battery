#!/bin/sh

case $BLOCK_BUTTON in
  4) xbacklight -inc 10 ;;
  5) xbacklight -dec 10 ;;
  6) "$TERMINAL" -e "$EDITOR" "$0"
esac

count="$(ls /sys/class/power_supply | grep "BAT*" | wc -w)"

[ "$count" = "0" ] && exit 0

for battery in /sys/class/power_supply/BAT?*; do
  [ -n "${capacity+x}" ] && printf " "

  case "$(cat "$battery/status")" in
    "Full") status="âš¡" ;;
    "Discharging") status="ğŸ”‹" ;;
    "Charging") status="ğŸ”Œ" ;;
    "Not charging") status="ğŸ›‘" ;;
    "Unknown") status="â™»ï¸" ;;
  esac


  capacity=$(cat "$battery/capacity")

  msg_b="ãƒãƒƒãƒ†ãƒªãƒ¼æ®‹é‡ãŒ"
  msg_a="ï¼…æœªæº€ã§ã™ã€‚\nãƒ‡ãƒã‚¤ã‚¹ã‚’å……é›»ã—ã¦ãã ã•ã„ã€‚"
  path="/tmp/$(echo -n "$battery" | tr '/' '_')_$capacity"

  [ "$status" = "ğŸ”‹" ] && [ "$capacity" -le 25 ] && warn="â—"

  if [ "$status" = "ğŸ”‹" ]; then
    if [ "$capacity" -eq 100 ] || [ "$capacity" -eq 10 ] || [ "$capacity" -eq 5 ] ; then
      notify-send "ãƒãƒƒãƒ†ãƒªãƒ¼ ğŸ”‹" "$msg_b$capacity$msg_a"
    fi
  fi


  printf "%s%d%s" "$status" "$capacity" "$warn"; unset warn

done && exit 0
